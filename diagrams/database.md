# Database Schema: DSA Gamify (PostgreSQL)

This document specifies the initial PostgreSQL database schema. The design follows a relational model to ensure data integrity for user progress and problem management.

## 1. Schema Diagram (Conceptual)
+-------------+      +-------------------+      +------------------+
|   users     |      |   user_progress   |      |    dsa_problems  |
|-------------|      |-------------------|      |------------------|
| id (PK)     |----<>| id (PK)           |<>----| id (PK)          |
| keycloak_id |      | user_id (FK)      |      | title            |
| username    |      | problem_id (FK)   |      | description      |
| level       |      | status            |      | category         |
| xp          |      | completed_at      |      | difficulty       |
| created_at  |      | code_snapshot     |      | solution         |
| updated_at  |      | created_at        |      | hints            |
+-------------+      +-------------------+      | is_daily_challenge|
| created_at       |
+------------------+

---

## 2. Table Definitions

### Table: `users`
Stores information about registered users. This table links the internal user record to the Keycloak user ID.

| Column        | Data Type             | Constraints                        | Description                                     |
|---------------|-----------------------|------------------------------------|-------------------------------------------------|
| `id`          | `SERIAL`              | `PRIMARY KEY`                      | Auto-incrementing internal user ID.             |
| `keycloak_id` | `VARCHAR(255)`        | `UNIQUE NOT NULL`                  | The unique subject ID from the Keycloak JWT.    |
| `username`    | `VARCHAR(100)`        | `UNIQUE NOT NULL`                  | User's display name.                            |
| `level`       | `INTEGER`             | `NOT NULL DEFAULT 1`               | The user's current level in the game.           |
| `xp`          | `INTEGER`             | `NOT NULL DEFAULT 0`               | The user's total experience points.             |
| `created_at`  | `TIMESTAMP WITH TIME ZONE` | `DEFAULT CURRENT_TIMESTAMP` | Timestamp of user creation.                     |
| `updated_at`  | `TIMESTAMP WITH TIME ZONE` | `DEFAULT CURRENT_TIMESTAMP` | Timestamp of last user update.                  |

### Table: `dsa_problems`
Stores the DSA problems, which can be generated by the LLM.

| Column             | Data Type             | Constraints                        | Description                                                    |
|--------------------|-----------------------|------------------------------------|----------------------------------------------------------------|
| `id`               | `SERIAL`              | `PRIMARY KEY`                      | Auto-incrementing problem ID.                                  |
| `title`            | `VARCHAR(255)`        | `NOT NULL`                         | The title of the problem.                                      |
| `description`      | `TEXT`                | `NOT NULL`                         | Full markdown-supported description of the problem.            |
| `category`         | `VARCHAR(50)`         | `NOT NULL`                         | e.g., 'Dynamic Programming', 'Graphs', 'Arrays'.             |
| `difficulty`       | `VARCHAR(50)`         | `NOT NULL`                         | e.g., 'Easy', 'Medium', 'Hard'.                                |
| `solution`         | `TEXT`                | `NOT NULL`                         | The detailed solution, likely including code and explanation.  |
| `hints`            | `TEXT`                | `NULL`                             | Optional hints for the user.                                   |
| `is_daily_challenge` | `BOOLEAN`             | `DEFAULT FALSE`                    | Flag to mark if this was a special daily challenge.            |
| `challenge_date`   | `DATE`                | `NULL`                             | The date for which this was a daily challenge.                 |
| `created_at`       | `TIMESTAMP WITH TIME ZONE` | `DEFAULT CURRENT_TIMESTAMP` | Timestamp of problem creation.                                 |

### Table: `user_progress`
A join table that tracks the status of each problem for each user.

| Column          | Data Type             | Constraints                                     | Description                                                   |
|-----------------|-----------------------|-------------------------------------------------|---------------------------------------------------------------|
| `id`            | `SERIAL`              | `PRIMARY KEY`                                   | Auto-incrementing ID for the progress entry.                  |
| `user_id`       | `INTEGER`             | `NOT NULL, REFERENCES users(id)`                | Foreign key to the `users` table.                             |
| `problem_id`    | `INTEGER`             | `NOT NULL, REFERENCES dsa_problems(id)`         | Foreign key to the `dsa_problems` table.                      |
| `status`        | `VARCHAR(50)`         | `NOT NULL`                                      | e.g., 'Not Attempted', 'Attempted', 'Solved'.                 |
| `completed_at`  | `TIMESTAMP WITH TIME ZONE` | `NULL`                                  | Timestamp when the user solved the problem.                   |
| `code_snapshot` | `TEXT`                | `NULL`                                          | A snapshot of the user's last submitted code.                 |
| `created_at`    | `TIMESTAMP WITH TIME ZONE` | `DEFAULT CURRENT_TIMESTAMP`                 | Timestamp of the first attempt.                               |
| **Composite Key** |                       | `UNIQUE (user_id, problem_id)`                  | Ensures a user has only one progress entry per problem.       |
